#!/usr/local/bin/perl -w
#
# GFFsplitter
# 
# v 0.1
# 
# dl

# Usage : GFFsplitter
#
# 

# v0.1
# 001129 : dl  : PP version

#################################################################################
# variables                                                                     #
#################################################################################

$|=1;
use IO::Handle;
use Getopt::Std;
use lib '/wormsrv2/scripts';
use Wormbase;

 ##############################
 # Script variables (run)     #
 ##############################

my $maintainers = "dl1\@sanger.ac.uk krb\@sanger.ac.uk kj2\@sanger.ac.uk";
my $rundate = `date +%y%m%d`; chomp $rundate;
my $runtime = `date +%H:%M:%S`; chomp $runtime;
my $cvs_version = &get_cvs_version($0);

 ##############################
 # Paths etc                  #
 ##############################

my $datadir = "/wormsrv2/autoace/GFF_SPLITS";

 ##############################
 # command-line options       #
 ##############################

$opt_h = "";   # Help/Usage page
getopts ('h');
&usage if ($opt_h);

 ########################################
 # Open logfile                         #
 ########################################

my $logfile = "/wormsrv2/logs/GFFsplitter.$rundate.$$";
open (LOG,">$logfile");
LOG->autoflush();

print LOG "# GFFsplitter\n\n";     
print LOG "# version        : $cvs_version\n";
print LOG "# run details    : $rundate $runtime\n";
print LOG "\n";

#################################################################################
# Main Loop                                                                     #
#################################################################################

 ############################################################
 # get the list of gff files from the data directory        #
 ############################################################

#opendir(CHROMOSOMES, $datadir) or die ("Could not opendir $datadir");
#while (defined($file=readdir(CHROMOSOMES))) {
#    next unless ($file =~ /CHROMOSOME_\S+\.gff/);
#    print LOG "$file\n";
#    push (@files,$file);
#}
#close CHROMOSOMES;

@files = (
	  'CHROMOSOME_I.gff',
	  'CHROMOSOME_II.gff',
	  'CHROMOSOME_III.gff',
	  'CHROMOSOME_IV.gff',
	  'CHROMOSOME_V.gff',
	  'CHROMOSOME_X.gff',
	  );

 ############################################################
 # sort them alphabetically                                 #
 ############################################################

@gff_files = sort @files; 
undef @files; 

 ############################################################
 # loop through each GFF file                               #
 ############################################################

$debug = 1;

foreach (@gff_files) {
    
    next if ($_ eq "");
    $file = $_;
    ($file_prefix) = (/^(\S+.+)\.gff/);
    print LOG "File $file   \tName : $file_prefix\n";
    $line_count = 0;

    #########################################################
    # initialise some files to write out data               #
    #########################################################

    $gff_clone_path           = $file_prefix . "\.clone_path\.gff";
    $gff_genes                = $file_prefix . "\.genes\.gff";
    $gff_pseudogenes          = $file_prefix . "\.pseudogenes\.gff";
    $gff_rna                  = $file_prefix . "\.rna\.gff";
    $gff_rest                 = $file_prefix . "\.rest\.gff";
    $gff_CDS_exon             = $file_prefix . "\.CDS_exon\.gff";
    $gff_exon                 = $file_prefix . "\.exon\.gff";
    $gff_exon_tRNA            = $file_prefix . "\.exon_tRNA\.gff";
    $gff_exon_pseudogene      = $file_prefix . "\.exon_pseudogene\.gff";
    $gff_intron               = $file_prefix . "\.intron\.gff";
    $gff_intron_tRNA          = $file_prefix . "\.intron_tRNA\.gff";
    $gff_intron_pseudogene    = $file_prefix . "\.intron_pseudogene\.gff";
    $gff_intron_confirmed_CDS = $file_prefix . "\.intron_confirmed_CDS\.gff";
    $gff_intron_confirmed_UTR = $file_prefix . "\.intron_confirmed_UTR\.gff";
    $gff_repeats              = $file_prefix . "\.repeats\.gff";
    $gff_ests                 = $file_prefix . "\.ests\.gff";
    $gff_tc_insertions        = $file_prefix . "\.tc_insertions\.gff";
    $gff_blastx               = $file_prefix . "\.blastx\.gff";
    $gff_tblastx_est          = $file_prefix . "\.tblastx_est\.gff";
    $gff_tblastx_briggsae     = $file_prefix . "\.tblastx_briggsae\.gff";
    $gff_assembly_tags        = $file_prefix . "\.assembly_tags\.gff";
    $gff_prosite              = $file_prefix . "\.prosite\.gff";
    $gff_oligos               = $file_prefix . "\.oligos\.gff";
    $gff_alleles              = $file_prefix . "\.alleles\.gff";
    $gff_clone_ends           = $file_prefix . "\.clone_ends\.gff";
    $gff_ts_site              = $file_prefix . "\.ts_site\.gff";
    $gff_RNAi                 = $file_prefix . "\.RNAi\.gff";
    $gff_genepair             = $file_prefix . "\.genepair\.gff";
    
    open (GFF_CLONE_PATH, ">$datadir/GFF_SPLITS/$gff_clone_path");
    print GFF_CLONE_PATH  "##gff-version 2\n";
    print GFF_CLONE_PATH  "##date $rundate\n";

    open (GFF_GENES, ">$datadir/GFF_SPLITS/$gff_genes");
    print GFF_GENES  "##gff-version 2\n";
    print GFF_GENES  "##date $rundate\n";

    open (GFF_PSEUDOGENES, ">$datadir/GFF_SPLITS/$gff_pseudogenes");
    print GFF_PSEUDOGENES  "##gff-version 2\n";
    print GFF_PSEUDOGENES  "##date $rundate\n";

    open (GFF_RNA, ">$datadir/GFF_SPLITS/$gff_rna");
    print GFF_RNA  "##gff-version 2\n";
    print GFF_RNA  "##date $rundate\n";

    open (GFF_REST, ">$datadir/GFF_SPLITS/$gff_rest");
#    print GFF_REST  "##gff-version 2\n";
#    print GFF_REST  "##date $rundate\n";

    open (GFF_CDS_EXON, ">$datadir/GFF_SPLITS/$gff_CDS_exon");
    print GFF_CDS_EXON  "##gff-version 2\n";
    print GFF_CDS_EXON  "##date $rundate\n";

    open (GFF_EXON, ">$datadir/GFF_SPLITS/$gff_exon");
    print GFF_EXON  "##gff-version 2\n";
    print GFF_EXON  "##date $rundate\n";

    open (GFF_EXON_tRNA, ">$datadir/GFF_SPLITS/$gff_exon_tRNA");
    print GFF_EXON_tRNA  "##gff-version 2\n";
    print GFF_EXON_tRNA  "##date $rundate\n";

    open (GFF_EXON_PSEUDOGENE, ">$datadir/GFF_SPLITS/$gff_exon_pseudogene");
    print GFF_EXON_PSEUDOGENE  "##gff-version 2\n";
    print GFF_EXON_PSEUDOGENE  "##date $rundate\n";

    open (GFF_INTRON, ">$datadir/GFF_SPLITS/$gff_intron");
    print GFF_INTRON  "##gff-version 2\n";
    print GFF_INTRON  "##date $rundate\n";

    open (GFF_INTRON_tRNA, ">$datadir/GFF_SPLITS/$gff_intron_tRNA");
    print GFF_INTRON_tRNA  "##gff-version 2\n";
    print GFF_INTRON_tRNA  "##date $rundate\n";

    open (GFF_INTRON_PSEUDOGENE, ">$datadir/GFF_SPLITS/$gff_intron_pseudogene");
    print GFF_INTRON_PSEUDOGENE  "##gff-version 2\n";
    print GFF_INTRON_PSEUDOGENE  "##date $rundate\n";

    open (GFF_INTRON_CONFIRMED_CDS, ">$datadir/GFF_SPLITS/$gff_intron_confirmed_CDS");
    print GFF_INTRON_CONFIRMED_CDS  "##gff-version 2\n";
    print GFF_INTRON_CONFIRMED_CDS  "##date $rundate\n";

    open (GFF_INTRON_CONFIRMED_UTR, ">$datadir/GFF_SPLITS/$gff_intron_confirmed_UTR");
    print GFF_INTRON_CONFIRMED_UTR  "##gff-version 2\n";
    print GFF_INTRON_CONFIRMED_UTR  "##date $rundate\n";

     open (GFF_REPEATS, ">$datadir/GFF_SPLITS/$gff_repeats");
    print GFF_REPEATS  "##gff-version 2\n";
    print GFF_REPEATS  "##date $rundate\n";

    open (GFF_ESTS, ">$datadir/GFF_SPLITS/$gff_ests");
    print GFF_ESTS  "##gff-version 2\n";
    print GFF_ESTS  "##date $rundate\n";

    open (GFF_TC_INSERTIONS, ">$datadir/GFF_SPLITS/$gff_tc_insertions");
    print GFF_TC_INSERTIONS  "##gff-version 2\n";
    print GFF_TC_INSERTIONS  "##date $rundate\n";

    open (GFF_BLASTX, ">$datadir/GFF_SPLITS/$gff_blastx");
    print GFF_BLASTX  "##gff-version 2\n";
    print GFF_BLASTX  "##date $rundate\n";

    open (GFF_TBLASTX_EST, ">$datadir/GFF_SPLITS/$gff_tblastx_est");
    print GFF_TBLASTX_EST  "##gff-version 2\n";
    print GFF_TBLASTX_EST  "##date $rundate\n";
 
    open (GFF_TBLASTX_BRIGGSAE, ">$datadir/GFF_SPLITS/$gff_tblastx_briggsae");
    print GFF_TBLASTX_BRIGGSAE  "##gff-version 2\n";
    print GFF_TBLASTX_BRIGGSAE  "##date $rundate\n";
 
    open (GFF_ASSEMBLY_TAGS, ">$datadir/GFF_SPLITS/$gff_assembly_tags");
    print GFF_ASSEMBLY_TAGS  "##gff-version 2\n";
    print GFF_ASSEMBLY_TAGS  "##date $rundate\n";

    open (GFF_TS_SITE, ">$datadir/GFF_SPLITS/$gff_ts_site");
    print GFF_TS_SITE  "##gff-version 2\n";
    print GFF_TS_SITE  "##date $rundate\n";

    open (GFF_PROSITE, ">$datadir/GFF_SPLITS/$gff_prosite");
    print GFF_PROSITE  "##gff-version 2\n";
    print GFF_PROSITE  "##date $rundate\n";

    open (GFF_OLIGOS, ">$datadir/GFF_SPLITS/$gff_oligos");
    print GFF_OLIGOS  "##gff-version 2\n";
    print GFF_OLIGOS  "##date $rundate\n";

    open (GFF_ALLELES, ">$datadir/GFF_SPLITS/$gff_alleles");
    print GFF_ALLELES  "##gff-version 2\n";
    print GFF_ALLELES  "##date $rundate\n";

    open (GFF_CLONE_ENDS, ">$datadir/GFF_SPLITS/$gff_clone_ends");
    print GFF_CLONE_ENDS  "##gff-version 2\n";
    print GFF_CLONE_ENDS  "##date $rundate\n";

    open (GFF_RNAi, ">$datadir/GFF_SPLITS/$gff_RNAi");
    print GFF_RNAi  "##gff-version 2\n";
    print GFF_RNAi  "##date $rundate\n";

    open (GFF_GENEPAIR, ">$datadir/GFF_SPLITS/$gff_genepair");
    print GFF_GENEPAIR  "##gff-version 2\n";
    print GFF_GENEPAIR  "##date $rundate\n";

 
    #########################################################
    # open the gff file                                     #
    #########################################################
    
    $gff_length = file_size("/wormsrv2/autoace/CHROMOSOMES/$file") - 3;
    print LOG "File contains $gff_length lines\n";
    print "File '$file' contains $gff_length lines\n";
    print "% complete :    "; 


    $running_total = -1;

    open (GFF, "</wormsrv2/autoace/CHROMOSOMES/$file");
    while (<GFF>) {
	chomp;
	
	$done = int ((($line_count / $file_length) * 100));
	printf "\b\b%2d", $done;
	STDOUT->autoflush();
	$line_count++;

	if (/\#\#sequence-region/) {
	    print GFF_REST                 "$_\n";
	    print GFF_CLONE_PATH           "$_\n";
	    print GFF_GENES                "$_\n";
	    print GFF_PSEUDOGENES          "$_\n";
	    print GFF_RNA                  "$_\n";
	    print GFF_CDS_EXON             "$_\n";
	    print GFF_EXON                 "$_\n";
	    print GFF_EXON_tRNA            "$_\n";
	    print GFF_EXON_PSEUDOGENE      "$_\n";
	    print GFF_INTRON               "$_\n";
	    print GFF_INTRON_tRNA          "$_\n";
	    print GFF_INTRON_PSEUDOGENE    "$_\n";
	    print GFF_INTRON_CONFIRMED_CDS "$_\n";
	    print GFF_INTRON_CONFIRMED_UTR "$_\n";
	    print GFF_REPEATS              "$_\n";
	    print GFF_ESTS                 "$_\n";
	    print GFF_TC_INSERTIONS        "$_\n";
	    print GFF_BLASTX               "$_\n";
	    print GFF_TBLASTX_EST          "$_\n";
	    print GFF_TBLASTX_BRIGGSAE     "$_\n";
	    print GFF_ASSEMBLY_TAGS        "$_\n";
	    print GFF_TS_SITE              "$_\n";
	    print GFF_PROSITE              "$_\n";
	    print GFF_OLIGOS               "$_\n";
	    print GFF_ALLELES              "$_\n";
	    print GFF_CLONE_ENDS           "$_\n";
	    print GFF_RNAi                 "$_\n";
	    print GFF_GENEPAIR             "$_\n";
	    next;
	}
	
	
#	@f = split (/\t/,$_);
	($name,$method,$feature,$start,$stop,$score,$strand,$other,$name) = split (/\t/,$_);
	
	undef $found_a_home;

	################################
	# Clone path                   #
	################################

	if (($method eq "Genomic_canonical") && ($feature eq "Sequence")) {
	    print GFF_CLONE_PATH "$_\n";
	    $found_a_home = 1;
	}
	
	################################
	# Genes
	################################
	
#	if (  (($method eq "curated")          && ($feature eq "transcription")) || 
#	      (($method eq "provisional")      && ($feature eq "transcription")) || 
#	      (($method eq "tRNAscan-SE-1.11") && ($feature eq "Sequence"))    ) {

	if (  (($method eq "curated")          && ($feature eq "Sequence")) || 
	      (($method eq "provisional")      && ($feature eq "Sequence")) || 
	      (($method eq "tRNAscan-SE-1.11") && ($feature eq "Sequence"))    ) {


	    print GFF_GENES "$_\n";
	    $found_a_home = 1;
	}

	if (  ($method eq "Pseudogene") && ($feature eq "Sequence")  ) {
	    print GFF_PSEUDOGENES "$_\n";
	    $found_a_home = 1;
	}
	
	################################
	# RNA genes
	################################

	if ( (($method eq "RNA") || ($method eq "tRNAscan-SE-1.11")) && ($feature eq "Sequence") ) {
	    
#	    print "$_\n" if ($debug);
	    print GFF_RNA "$_\n";
	    $found_a_home = 1;
	}

	################################
	# CDS Exon
	################################

	if ((($method eq "curated") || ($method eq "provisional")) && ($feature eq "CDS")) {
#	    print "$_\n" if ($debug);
	    print GFF_CDS_EXON "$_\n";
	    $found_a_home = 1;
	}
	################################
	# Exon
	################################

	if ((($method eq "curated") || ($method eq "provisional")) && ($feature eq "exon")) {
#	    print "$_\n" if ($debug);
	    print GFF_EXON "$_\n";
	    $found_a_home = 1;
	}
	    
	if (($method eq "tRNAscan-SE-1.11") && ($feature eq "exon")) {
	    print GFF_EXON_tRNA "$_\n";
	    $found_a_home = 1;
	}
	    
	if (($method eq "Pseudogene") && ($feature eq "exon")) {
	    print GFF_EXON_PSEUDOGENE "$_\n";
	    $found_a_home = 1;
	}
	    
	################################
	# Intron
	################################

	if ((($method eq "curated") || ($method eq "provisional")) && ($feature eq "intron")) {
#	    print "$_\n" if ($debug);
	    print GFF_INTRON "$_\n";
	    $found_a_home = 1;
	}
	if (($method eq "tRNAscan-SE-1.11") && ($feature eq "intron")) {
	    print GFF_INTRON_tRNA "$_\n";
	    $found_a_home = 1;
	}
	if (($method eq "Pseudogene") && ($feature eq "intron")) {
	    print GFF_INTRON_PSEUDOGENE "$_\n";
	    $found_a_home = 1;
	}
	
	################################
	# Intron confirmed by ESTs
	################################

	if (/Confirmed_by_EST/) {
	    print GFF_INTRON_CONFIRMED_CDS "$_\n";
	    $found_a_home = 1;
	}


	if (/Confirmed_by_cDNA/) {
	    print GFF_INTRON_CONFIRMED_CDS "$_\n";
	    $found_a_home = 1;
	}

	if (/Confirmed_in_UTR/) {
	    print GFF_INTRON_CONFIRMED_UTR "$_\n";
	    $found_a_home = 1;
	}

	################################
        # Repeats
	################################
	
	if (($method eq "tandem") || ($method eq "inverted") || ($method eq "hmmfs.3") || ($method eq "scan") || ($feature eq "repeat_region")) {
#	    print "$_\n" if ($debug);
	    print GFF_REPEATS "$_\n";
	    $found_a_home = 1;
	}

	################################
   	# ESTs
	################################

	if (($method eq "BLASTN_EST_elegans") || ($method eq "EST_GENOME")) {
#	    print "$_\n" if ($debug);
	    print GFF_ESTS "$_\n";
	    $found_a_home = 1;
	}
	

	################################
   	# TC1 insertions
	################################

	if ($method eq "BLASTN_TC1") {
#	    print "$_\n" if ($debug);
	    print GFF_TC_INSERTIONS "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# Protein similarities
	################################

	if ($method eq "BLASTX") {
#	    print "$_\n" if ($debug);
	    print GFF_BLASTX "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# EST similarities (distant)
	################################

	if (($method eq "TBLASTX_EST") || ($method eq "TBLASTX_EST_elegans")) {
#	    print "$_\n" if ($debug);
	    print GFF_TBLASTX_EST "$_\n";
	    $found_a_home = 1;
	}

	################################
   	# C.briggsae similarities 
	################################

	if (($method eq "TBLASTX_briggsae") || ($method eq "BLASTN_EST_briggsae") || ($method eq "TBLASTX_C.briggsae") || ($method eq "BLASTN_briggsae_cosmid")  || ($method eq "BLASTN_eleg_brig")) {
#	    print "$_\n" if ($debug);
	    print GFF_TBLASTX_BRIGGSAE "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# Assembly tags
	################################

	if ($method eq "assembly_tag") {
#	    print "$_\n" if ($debug);
	    print GFF_ASSEMBLY_TAGS "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# TS site
	################################

	if ((/misc_feature/) && (/trans-splice site/)) {
#	    print "$_\n" if ($debug);
	    print GFF_TS_SITE "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# Prosite
	################################

	if ($method eq "Queryprosite") {
#	    print "$_\n" if ($debug);
	    print GFF_PROSITE "$_\n";
	    $found_a_home = 1;
	}
	

	################################
   	# Oligo mapping 
	################################

	if ($feature eq "OLIGO_PAIR") {
#	    print "$_\n" if ($debug);
	    print GFF_OLIGOS "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# RNAi 
	################################

	if ($method eq "RNAi") {
#	    print "$_\n" if ($debug);
	    print GFF_RNAi "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# GENEPAIR
	################################

	if ($method eq "GenePair_STS") {
#	    print "$_\n" if ($debug);
	    print GFF_GENEPAIR "$_\n";
	    $found_a_home = 1;
	}
	
	################################
   	# Alleles
	################################

	if (/Allele/) {
#	    print "$_\n" if ($debug);
	    print GFF_ALLELES "$_\n";
	    $found_a_home = 1;
	}
	

	################################
   	# Clone ends
	################################

	if ((/Clone_left_end/) || (/Clone_right_end/)) {
#	    print "$_\n" if ($debug);
	    print GFF_CLONE_ENDS "$_\n";
	    $found_a_home = 1;
	}
	
	print GFF_REST "$_\n" unless ($found_a_home); 
	$running_total++ if ($found_a_home); 
	    
    }
    close GFF;
    
    print "\n";

    close GFF_REST;
    close GFF_CLONE_PATH;
    close GFF_GENES;
    close GFF_PSEUDOGENES;
    close GFF_RNA;
    close GFF_CDS_EXON;
    close GFF_EXON;
    close GFF_EXON_tRNA;
    close GFF_EXON_PSEUDOGENE;
    close GFF_INTRON;
    close GFF_INTRON_tRNA;
    close GFF_INTRON_PSEUDOGENE;
    close GFF_INTRON_CONFIRMED_CDS;
    close GFF_INTRON_CONFIRMED_UTR;
    close GFF_REPEATS;
    close GFF_ESTS;
    close GFF_TC_INSERTIONS;
    close GFF_BLASTX;
    close GFF_TBLASTX_EST;
    close GFF_TBLASTX_BRIGGSAE;
    close GFF_ASSEMBLY_TAGS;
    close GFF_TS_SITE;
    close GFF_PROSITE;
    close GFF_OLIGOS;
    close GFF_ALLELES;
    close GFF_CLONE_ENDS;

    	########################################
   	# count file lengths for all GFF files #
	###########################################

    my $total_lines = 0;
    print "\n\nGFF file lengths\n\n";
    
    $gff_length_clone_path = file_size("$datadir/GFF_SPLITS/$gff_clone_path") - 3;
    $total_lines = $total_lines + $gff_length_clone_path;
    print "$gff_clone_path\t: $gff_length_clone_path\n";
    
    $gff_length_genes = file_size("$datadir/GFF_SPLITS/$gff_genes") - 3;
    $total_lines = $total_lines + $gff_length_genes;
    print "$gff_genes   \t\t: $gff_length_genes\n";

    $gff_length_pseudogenes = file_size("$datadir/GFF_SPLITS/$gff_pseudogenes") - 3;
    $total_lines = $total_lines + $gff_length_pseudogenes;
    print "$gff_pseudogenes   \t\t: $gff_length_pseudogenes\n";

    $gff_length_rna = file_size("$datadir/GFF_SPLITS/$gff_rna") - 3;
    $total_lines = $total_lines + $gff_length_rna;
    print "$gff_rna     \t\t: $gff_length_rna\n";
    
    $gff_length_CDS_exon = file_size("$datadir/GFF_SPLITS/$gff_CDS_exon") - 3;
    $total_lines = $total_lines + $gff_length_CDS_exon;
    print "$gff_CDS_exon   \t\t: $gff_length_CDS_exon\n";

    $gff_length_exon = file_size("$datadir/GFF_SPLITS/$gff_exon") - 3;
    $total_lines = $total_lines + $gff_length_exon;
    print "$gff_exon   \t\t: $gff_length_exon\n";

    $gff_length_exon_tRNA = file_size("$datadir/GFF_SPLITS/$gff_exon_tRNA") - 3;
    $total_lines = $total_lines + $gff_length_exon_tRNA;
    print "$gff_exon_tRNA   \t\t: $gff_length_exon_tRNA\n";

    $gff_length_exon_pseudogene = file_size("$datadir/GFF_SPLITS/$gff_exon_pseudogene") - 3;
    $total_lines = $total_lines + $gff_length_exon_pseudogene;
    print "$gff_exon_pseudogene   \t: $gff_length_exon_pseudogene\n";

    $gff_length_intron = file_size("$datadir/GFF_SPLITS/$gff_intron") - 3;
    $total_lines = $total_lines + $gff_length_intron;
    print "$gff_intron   \t\t: $gff_length_intron\n";
    
    $gff_length_intron_tRNA = file_size("$datadir/GFF_SPLITS/$gff_intron_tRNA") - 3;
    $total_lines = $total_lines + $gff_length_intron_tRNA;
    print "$gff_intron_tRNA   \t\t: $gff_length_intron_tRNA\n";
    
    $gff_length_intron_pseudogene = file_size("$datadir/GFF_SPLITS/$gff_intron_pseudogene") - 3;
    $total_lines = $total_lines + $gff_length_intron_pseudogene;
    print "$gff_intron_pseudogene   \t: $gff_length_intron_pseudogene\n";
    
    $gff_length_intron_confirmed_CDS = file_size("$datadir/GFF_SPLITS/$gff_intron_confirmed_CDS") - 3;
    $total_lines = $total_lines + $gff_length_intron_confirmed_CDS;
    print "$gff_intron_confirmed_CDS\t: $gff_length_intron_confirmed_CDS\n";
    
    $gff_length_intron_confirmed_UTR = file_size("$datadir/GFF_SPLITS/$gff_intron_confirmed_UTR") - 3;
    $total_lines = $total_lines + $gff_length_intron_confirmed_UTR;
    print "$gff_intron_confirmed_UTR\t: $gff_length_intron_confirmed_UTR\n";
    
    $gff_length_repeats = file_size("$datadir/GFF_SPLITS/$gff_repeats") - 3;
    $total_lines = $total_lines + $gff_length_repeats;
    print "$gff_repeats   \t\t: $gff_length_repeats\n";

    $gff_length_ests = file_size("$datadir/GFF_SPLITS/$gff_ests") - 3;
    $total_lines = $total_lines + $gff_length_ests;
    print "$gff_ests   \t\t: $gff_length_ests\n";

    $gff_length_tc_insertions = file_size("$datadir/GFF_SPLITS/$gff_tc_insertions") - 3;
    $total_lines = $total_lines + $gff_length_tc_insertions;
    print "$gff_tc_insertions   \t: $gff_length_tc_insertions\n";

    $gff_length_blastx = file_size("$datadir/GFF_SPLITS/$gff_blastx") - 3;
    $total_lines = $total_lines + $gff_length_blastx;
    print "$gff_blastx   \t\t: $gff_length_blastx\n";

    $gff_length_tblastx_est = file_size("$datadir/GFF_SPLITS/$gff_tblastx_est") - 3;
    $total_lines = $total_lines + $gff_length_tblastx_est;
    print "$gff_tblastx_est  \t\t: $gff_length_tblastx_est\n";
    
    $gff_length_tblastx_briggsae = file_size("$datadir/GFF_SPLITS/$gff_tblastx_briggsae") - 3;
    $total_lines = $total_lines + $gff_length_tblastx_briggsae;
    print "$gff_tblastx_briggsae    \t: $gff_length_tblastx_briggsae\n";

    $gff_length_assembly_tags = file_size("$datadir/GFF_SPLITS/$gff_assembly_tags") - 3;
    $total_lines = $total_lines + $gff_length_assembly_tags;
    print "$gff_assembly_tags   \t: $gff_length_assembly_tags\n";
    
    $gff_length_ts_site = file_size("$datadir/GFF_SPLITS/$gff_ts_site") - 3;
    $total_lines = $total_lines + $gff_length_ts_site;
    print "$gff_ts_site   \t\t: $gff_length_ts_site\n";
    
    $gff_length_prosite = file_size("$datadir/GFF_SPLITS/$gff_prosite") - 3;
    $total_lines = $total_lines + $gff_length_prosite;
    print "$gff_prosite   \t\t: $gff_length_prosite\n";

    $gff_length_oligos = file_size("$datadir/GFF_SPLITS/$gff_oligos") - 3;
    $total_lines = $total_lines + $gff_length_oligos;
    print "$gff_oligos   \t\t: $gff_length_oligos\n";

    $gff_length_alleles = file_size("$datadir/GFF_SPLITS/$gff_alleles") - 3;
    $total_lines = $total_lines + $gff_length_alleles;
    print "$gff_alleles   \t\t: $gff_length_alleles\n";

    $gff_length_clone_ends = file_size("$datadir/GFF_SPLITS/$gff_clone_ends") - 3;
    $total_lines = $total_lines + $gff_length_clone_ends;
    print "$gff_clone_ends   \t\t: $gff_length_clone_ends\n";
    
    $gff_length_RNAi = file_size("$datadir/GFF_SPLITS/$gff_RNAi") - 3;
    $total_lines = $total_lines + $gff_length_RNAi;
    print "$gff_RNAi   \t\t: $gff_length_RNAi\n";
    
    $gff_length_genepair = file_size("$datadir/GFF_SPLITS/$gff_genepair") - 3;
    $total_lines = $total_lines + $gff_length_genepair;
    print "$gff_genepair   \t\t: $gff_length_genepair\n";
    
    $gff_length_rest = file_size("$datadir/GFF_SPLITS/$gff_rest") - 3;
    $total_lines = $total_lines + $gff_length_rest;
    print "$gff_rest   \t\t: $gff_length_rest\n";
    
    my $lines_split = int ((($running_total / $gff_length) * 100) + 0.5);
    my $discarded_lines = $gff_length - $total_lines;
    print "\nLine parsed to files : $gff_length $running_total [$lines_split %]\n";
    print "Discarded lines       : $discarded_lines\n";
    print "\n\n";



   #########################################
   # Alter clone file to include accession #
   #########################################
   
    system ("GFF_with_accessions $datadir/GFF_SPLITS/${file_prefix}.clone_path.gff > $datadir/GFF_SPLITS/${file_prefix}.clone_acc.gff");
    
}

close LOG;


###############################
# Mail log to curator         #
###############################

open (OUTLOG,  "|/usr/bin/mailx -s \"WormBase Report: GFFsplitter\" $maintainers ");
open (READLOG, "<$logfile");
while (<READLOG>) {
    print OUTLOG "$_";
}
close READLOG;
close OUTLOG;

###############################
# hasta luego                 #
###############################

exit 0;

sub file_size {

    my $file = shift;
    open (FILE_SIZE, "/bin/cat $file | wc -l |");
    while (<FILE_SIZE>) {
	chomp;
	s/\s//g;
	$file_length = $_;
    }
    close FILE_SIZE;
    print LOG "Counting No. of lines in file '$file' : $file_length\n" if ($debug);
    return $file_length;
}

